# äº‹ä»¶é©±åŠ¨æ¶æ„è®¾è®¡æ–¹æ¡ˆ

## ğŸ¯ æ¶æ„ç›®æ ‡

å°†å½“å‰çš„å•ä½“æ¶æ„é‡æ„ä¸ºäº‹ä»¶é©±åŠ¨çš„å¾®æœåŠ¡æ¶æ„ï¼Œæå‡ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€å“åº”æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

## ğŸ—ï¸ å¾®æœåŠ¡è®¾è®¡

### æ ¸å¿ƒæœåŠ¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Gateway   â”‚  Event Bus      â”‚   Load Balancer  â”‚  Monitoring     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                â”‚                â”‚            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Message Broker (Redis/RabbitMQ)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Document Service â”‚  Search Service   â”‚  Agent Service   â”‚  Notify Service  â”‚  User Service    â”‚
â”‚  (ç«¯å£: 8003)   â”‚  (ç«¯å£: 8004)     â”‚  (ç«¯å£: 8005)    â”‚  (ç«¯å£: 8006)   â”‚  (ç«¯å£: 8007)    â”‚
â”‚                 â”‚                 â”‚                 â”‚                 â”‚                  â”‚
â”‚ â€¢ PDFè§£æ       â”‚ â€¢ å‘é‡æ£€ç´¢       â”‚ â€¢ å­¦ä¹ Agent     â”‚ â€¢ é‚®ä»¶/å¾®ä¿¡      â”‚ â€¢ ç”¨æˆ·ç®¡ç†      â”‚
â”‚ â€¢ æ–‡æ¡£æå–     â”‚ â€¢ è¯­ä¹‰æœç´¢       â”‚ â€¢ æ¨èAgent     â”‚ â€¢ ç³»ç»Ÿé€šçŸ¥      â”‚ â€¢ æƒé™æ§åˆ¶      â”‚
â”‚ â€¢ æ ¼å¼è½¬æ¢     â”‚ â€¢ å…³é”®è¯æœç´¢     â”‚ â€¢ ç­–ç•¥Agent     â”‚ â€¢ çŠ¶æ€å˜æ›´      â”‚ â€¢ è®¤è¯æˆæƒ      â”‚
â”‚                 â”‚                 â”‚                 â”‚                 â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                â”‚                â”‚            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PostgreSQL Database (ä¸»æ•°æ®åº“)                         â”‚
â”‚  - knowledge_entries, recommendations, users, events              â”‚
â”‚  - å‘é‡ç´¢å¼• (pgvector), å…¨æ–‡æœç´¢ç´¢å¼•                              â”‚
â”‚  - äº‹ä»¶å­˜å‚¨è¡¨, å·¥ä½œæµçŠ¶æ€è¡¨                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœåŠ¡èŒè´£å®šä¹‰

#### 1. Document Service (æ–‡æ¡£å¤„ç†æœåŠ¡)
**ç«¯å£**: 8003
**èŒè´£**:
- æ–‡æ¡£æ¥æ”¶å’Œé¢„å¤„ç†
- PDFã€Wordã€Excelæ–‡æ¡£è§£æ
- å¤šæ¨¡æ€å†…å®¹æå–ï¼ˆæ–‡æœ¬ã€å›¾åƒã€è¡¨æ ¼ï¼‰
- æ–‡æ¡£æ ¼å¼è½¬æ¢å’Œæ ‡å‡†åŒ–
- å‘åˆå§‹äº‹ä»¶å‘å¸ƒ

**æŠ€æœ¯æ ˆ**: Python + FastAPI + PyPDF2 + python-docx + OpenCV

#### 2. Search Service (æœç´¢æœåŠ¡)
**ç«¯å£**: 8004
**èŒè´£**:
- å‘é‡åµŒå…¥ç”Ÿæˆå’Œç´¢å¼•
- è¯­ä¹‰ç›¸ä¼¼åº¦æ£€ç´¢
- å…³é”®è¯å…¨æ–‡æœç´¢
- æ··åˆæœç´¢ç®—æ³•
- ç»“æœæ’åºå’Œåˆ†é¡µ

**æŠ€æœ¯æ ˆ**: Python + FastAPI + pgvector + sentence-transformers

#### 3. Agent Service (æ™ºèƒ½ä½“æœåŠ¡)
**ç«¯å£**: 8005
**èŒè´£**:
- å„ç±»æ™ºèƒ½Agentçš„ç»Ÿä¸€ç®¡ç†
- Agenté—´åä½œå’Œä»»åŠ¡åˆ†å‘
- å¤æ‚ä»»åŠ¡åˆ†è§£å’Œæ‰§è¡Œ
- Agentæ‰§è¡ŒçŠ¶æ€è¿½è¸ª
- ç»“æœèšåˆå’Œè¿”å›

**æŠ€æœ¯æ ˆ**: Python + FastAPI + Celery + Redis

#### 4. Notify Service (é€šçŸ¥æœåŠ¡)
**ç«¯å£**: 8006
**èŒè´£**:
- å¤šæ¸ é“é€šçŸ¥å‘é€
- é‚®ä»¶ã€çŸ­ä¿¡ã€ä¼ä¸šå¾®ä¿¡é›†æˆ
- ç³»ç»Ÿäº‹ä»¶å¹¿æ’­
- ç”¨æˆ·åå¥½ç®¡ç†
- é€šçŸ¥æ¨¡æ¿ç®¡ç†

**æŠ€æœ¯æ ˆ**: Python + FastAPI + SMTP + ä¼ä¸šå¾®ä¿¡API

#### 5. User Service (ç”¨æˆ·æœåŠ¡)
**ç«¯å£**: 8007
**èŒè´£**:
- ç”¨æˆ·æ³¨å†Œå’Œè®¤è¯
- æƒé™ç®¡ç†å’ŒRBAC
- ç”¨æˆ·ç”»åƒå’Œè¡Œä¸ºåˆ†æ
- ä¼šè¯ç®¡ç†
- æ•°æ®è®¿é—®æ§åˆ¶

**æŠ€æœ¯æ ˆ**: Python + FastAPI + JWT + OAuth2

## ğŸŒŠ äº‹ä»¶ç³»ç»Ÿè®¾è®¡

### äº‹ä»¶æ€»çº¿æ¶æ„

```python
# äº‹ä»¶æ ¸å¿ƒç±»å‹å®šä¹‰
from enum import Enum
from dataclasses import dataclass
from typing import Dict, Any, Optional
from datetime import datetime
import json

class EventType(Enum):
    # æ–‡æ¡£ç›¸å…³äº‹ä»¶
    DOCUMENT_UPLOADED = "document.uploaded"
    DOCUMENT_PROCESSED = "document.processed"
    DOCUMENT_EXTRACTED = "document.extracted"
    DOCUMENT_INDEXED = "document.indexed"

    # æœç´¢ç›¸å…³äº‹ä»¶
    SEARCH_QUERY = "search.query"
    SEARCH_COMPLETED = "search.completed"
    SEARCH_FAILED = "search.failed"

    # Agentç›¸å…³äº‹ä»¶
    AGENT_TRIGGERED = "agent.triggered"
    AGENT_STARTED = "agent.started"
    AGENT_COMPLETED = "agent.completed"
    AGENT_FAILED = "agent.failed"

    # ç”¨æˆ·ç›¸å…³äº‹ä»¶
    USER_LOGIN = "user.login"
    USER_QUERY = "user.query"
    USER_FEEDBACK = "user.feedback"

    # ç³»ç»Ÿç›¸å…³äº‹ä»¶
    SYSTEM_ALERT = "system.alert"
    SYSTEM_MAINTENANCE = "system.maintenance"
    SYSTEM_BACKUP = "system.backup"

@dataclass
class Event:
    id: str
    type: EventType
    source: str  # äº‹ä»¶æ¥æºæœåŠ¡
    timestamp: datetime
    data: Dict[str, Any]
    correlation_id: Optional[str] = None
    causation_id: Optional[str] = None
    user_id: Optional[str] = None
    priority: int = 5  # 1-10, 1æœ€é«˜ä¼˜å…ˆçº§

    def to_dict(self) -> Dict:
        return {
            "id": self.id,
            "type": self.type.value,
            "source": self.source,
            "timestamp": self.timestamp.isoformat(),
            "data": self.data,
            "correlation_id": self.correlation_id,
            "causation_id": self.causation_id,
            "user_id": self.user_id,
            "priority": self.priority
        }
```

### äº‹ä»¶å¤„ç†æµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant G as API Gateway
    participant E as Event Bus
    participant DS as Document Service
    participant SS as Search Service
    participant AS as Agent Service
    participant NS as Notify Service

    U->>G: ä¸Šä¼ æ–‡æ¡£
    G->>E: å‘å¸ƒ DOCUMENT_UPLOADED äº‹ä»¶
    E->>DS: è½¬å‘äº‹ä»¶
    DS->>DS: å¤„ç†æ–‡æ¡£
    DS->>E: å‘å¸ƒ DOCUMENT_PROCESSED
    E->>SS: è½¬å‘äº‹ä»¶
    SS->>SS: ç”Ÿæˆå‘é‡ç´¢å¼•
    SS->>E: å‘å¸ƒ DOCUMENT_INDEXED
    E->>AS: è½¬å‘äº‹ä»¶
    AS->>AS: è§¦å‘å­¦ä¹ Agent
    AS->>E: å‘å¸ƒ AGENT_COMPLETED
    E->>NS: è½¬å‘äº‹ä»¶
    NS->>U: å‘é€å®Œæˆé€šçŸ¥
```

## ğŸ”§ æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 1. æ¶ˆæ¯ä»£ç†é€‰æ‹©

**æ¨è**: Redis Streams
- è½»é‡çº§ï¼Œæ˜“äºéƒ¨ç½²
- æŒä¹…åŒ–å­˜å‚¨æ”¯æŒ
- é«˜æ€§èƒ½è¯»å†™
- é›†ç¾¤æ”¯æŒ
- ç®€åŒ–è¿ç»´

**å¤‡é€‰**: RabbitMQ
- åŠŸèƒ½æ›´ä¸°å¯Œ
- æ›´å¥½çš„ç®¡ç†ç•Œé¢
- æ’ä»¶ç”Ÿæ€å®Œå–„

### 2. æœåŠ¡é—´é€šä¿¡

```python
# æœåŠ¡é—´é€šä¿¡æ¥å£å®šä¹‰
class ServiceCommunicator:
    def __init__(self, redis_client, service_name: str):
        self.redis = redis_client
        self.service_name = service_name
        self.subscriptions = {}

    async def publish_event(self, event: Event):
        """å‘å¸ƒäº‹ä»¶åˆ°äº‹ä»¶æ€»çº¿"""
        event_data = json.dumps(event.to_dict(), ensure_ascii=False)

        # å‘å¸ƒåˆ°Redis Streams
        await self.redis.xadd(
            f"events:{event.type.value}",
            event_data.encode('utf-8'),
            maxlen=1000,
            approximate_trim_length=True
        )

        # å‘é€åˆ°å¯¹åº”æœåŠ¡çš„äº‹ä»¶é€šé“
        await self.redis.publish(
            f"service:{event.type.value}:{event.source}",
            event_data
        )

    async def subscribe_events(self, event_types: List[EventType], callback):
        """è®¢é˜…ç‰¹å®šç±»å‹çš„äº‹ä»¶"""
        for event_type in event_types:
            stream_name = f"events:{event_type.value}"

            # åˆ›å»ºæ¶ˆè´¹è€…ç»„
            await self.redis.xgroup_create(
                stream_name,
                f"{self.service_name}_group",
                mkstream=True
            )

            # æ¶ˆè´¹äº‹ä»¶
            while True:
                try:
                    events = await self.redis.xreadgroup(
                        f"{self.service_name}_group",
                        stream_name,
                        {">": "$"},  # ä»æœ€æ–°ä½ç½®å¼€å§‹è¯»å–
                        block=1000,
                        count=10
                    )

                    for stream, messages in events:
                        for message in messages:
                            event_data = json.loads(message[1].decode('utf-8'))
                            event = Event(**event_data)
                            await callback(event)

                except Exception as e:
                    logger.error(f"Error processing event: {e}")
                    await asyncio.sleep(1)
```

### 3. æ•°æ®åº“è¿ç§»ç­–ç•¥

```python
# æ•°æ®åº“è¿ç§»è„šæœ¬
class DatabaseMigrator:
    def __init__(self):
        self.sqlite_path = "knowledge_base.db"
        self.postgres_config = {
            "host": "localhost",
            "port": 5432,
            "database": "knowledge_base",
            "user": "postgres",
            "password": "password"
        }

    async def migrate_to_postgres(self):
        """ä»SQLiteè¿ç§»åˆ°PostgreSQL"""
        # 1. åˆ›å»ºPostgreSQLæ•°æ®åº“ç»“æ„
        await self.create_postgres_schema()

        # 2. è¿ç§»æ ¸å¿ƒæ•°æ®
        await self.migrate_knowledge_entries()
        await self.migrate_recommendations()
        await self.migrate_users()

        # 3. åˆ›å»ºå‘é‡ç´¢å¼•è¡¨
        await self.create_vector_index_table()

        # 4. è¿ç§»å‘é‡æ•°æ®
        await self.migrate_embeddings()

        logger.info("Database migration completed")

    async def create_postgres_schema(self):
        """åˆ›å»ºPostgreSQLæ•°æ®åº“ç»“æ„"""
        # SQL DDLè¯­å¥
        schema_sql = """
        -- åˆ›å»ºæ‰©å±•
        CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
        CREATE EXTENSION IF NOT EXISTS "pgvector";

        -- çŸ¥è¯†æ¡ç›®è¡¨
        CREATE TABLE IF NOT EXISTS knowledge_entries (
            id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
            name TEXT NOT NULL,
            description TEXT,
            entity_type TEXT NOT NULL,
            attributes_json JSONB,
            embedding_vector vector(384),
            created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
            updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
            created_by UUID REFERENCES users(id),
            updated_by UUID REFERENCES users(id),
            version INTEGER DEFAULT 1,
            is_active BOOLEAN DEFAULT true
        );

        -- å‘é‡ç´¢å¼•è¡¨
        CREATE TABLE IF NOT EXISTS vector_index (
            id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
            knowledge_entry_id UUID REFERENCES knowledge_entries(id),
            vector vector(384),
            created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
        );

        -- äº‹ä»¶è¡¨
        CREATE TABLE IF NOT EXISTS events (
            id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
            event_type VARCHAR(100) NOT NULL,
            source_service VARCHAR(100) NOT NULL,
            correlation_id UUID,
            causation_id UUID,
            user_id UUID,
            timestamp TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
            data JSONB,
            priority INTEGER DEFAULT 5,
            processed BOOLEAN DEFAULT FALSE,
            created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
        );

        -- æ¨èè¡¨
        CREATE TABLE IF NOT EXISTS recommendations (
            id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
            inquiry_id UUID,
            recommended_products JSONB,
            recommended_suppliers JSONB,
            recommended_price_range NUMRANGE,
            confidence_score DECIMAL(5,2),
            recommendation_type TEXT,
            recommendation_reason TEXT,
            expires_at TIMESTAMP WITH TIME ZONE,
            created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
            created_by UUID REFERENCES users(id)
        );

        -- åˆ›å»ºç´¢å¼•
        CREATE INDEX idx_knowledge_entries_type ON knowledge_entries(entity_type);
        CREATE INDEX idx_knowledge_entries_created ON knowledge_entries(created_at);
        CREATE INDEX idx_events_type ON events(event_type);
        CREATE INDEX idx_events_timestamp ON events(timestamp);
        CREATE INDEX idx_events_processed ON events(processed);
        CREATE INDEX idx_recommendations_inquiry ON recommendations(inquiry_id);
        CREATE INDEX idx_recommendations_created ON recommendations(created_at);

        -- åˆ›å»ºå‘é‡ç´¢å¼•
        CREATE INDEX idx_vector_index_vector ON vector_index USING ivfflat (vector vector_cosine_ops);
        """

        # æ‰§è¡ŒSQL
        await self.execute_sql(schema_sql)
```

### 4. APIç½‘å…³è®¾è®¡

```python
# APIç½‘å…³é…ç½®
class APIGateway:
    def __init__(self):
        self.routes = {
            "/api/v1/documents/*": "http://localhost:8003",
            "/api/v1/search/*": "http://localhost:8004",
            "/api/v1/agents/*": "http://localhost:8005",
            "/api/v1/notifications/*": "http://localhost:8006",
            "/api/v1/users/*": "http://localhost:8007",
            "/api/v1/events/*": "event-bus",
            "/api/v1/health": "health-check"
        }

    async def route_request(self, method: str, path: str, data: Dict = None):
        """è·¯ç”±è¯·æ±‚åˆ°å¯¹åº”çš„æœåŠ¡"""
        # è·¯ç”±åŒ¹é…
        for pattern, service_url in self.routes.items():
            if path.startswith(pattern):
                service_url = service_url
                break
        else:
            raise HTTPException(status_code=404, detail="Service not found")

        # æ„å»ºç›®æ ‡URL
        target_url = service_url + path

        # è½¬å‘è¯·æ±‚
        async with httpx.AsyncClient() as client:
            if method == "GET":
                response = await client.get(target_url)
            elif method == "POST":
                response = await client.post(target_url, json=data)
            elif method == "PUT":
                response = await client.put(target_url, json=data)
            elif method == "DELETE":
                response = await client.delete(target_url)
            else:
                raise HTTPException(status_code=405, detail="Method not allowed")

            return response

# è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»
class LoadBalancer:
    def __init__(self):
        self.service_instances = {
            "document_service": [
                "http://localhost:8003",
                "http://localhost:8003"
            ],
            "search_service": [
                "http://localhost:8004"
            ]
        }
        self.health_status = {}

    async def get_healthy_service(self, service_name: str):
        """è·å–å¥åº·çš„æœåŠ¡å®ä¾‹"""
        instances = self.service_instances.get(service_name, [])

        for instance in instances:
            try:
                async with httpx.AsyncClient() as client:
                    response = await client.get(f"{instance}/health", timeout=5.0)
                    if response.status_code == 200:
                        return instance
            except Exception:
                continue

        return instances[0] if instances else None
```

## ğŸš€ å®æ–½è®¡åˆ’

### é˜¶æ®µ1ï¼šåŸºç¡€è®¾æ–½æ­å»ºï¼ˆ1-2å‘¨ï¼‰
1. æ¶ˆæ¯ä»£ç†éƒ¨ç½²ï¼ˆRedisï¼‰
2. PostgreSQLæ•°æ®åº“è®¾ç½®
3. æœåŠ¡å®¹å™¨åŒ–ï¼ˆDockerï¼‰
4. åŸºç¡€æœåŠ¡æ¡†æ¶æ­å»º

### é˜¶æ®µ2ï¼šæ ¸å¿ƒæœåŠ¡è¿ç§»ï¼ˆ2-3å‘¨ï¼‰
1. Document Serviceç‹¬ç«‹éƒ¨ç½²
2. Search Serviceå‘é‡ç´¢å¼•è¿ç§»
3. Agent Serviceé‡æ„
4. äº‹ä»¶ç³»ç»Ÿé›†æˆ

### é˜¶æ®µ3ï¼šç”¨æˆ·å’Œæ•°æ®è¿ç§»ï¼ˆ1-2å‘¨ï¼‰
1. æ•°æ®åº“å¹³æ»‘è¿ç§»
2. ç”¨æˆ·è®¤è¯ç³»ç»Ÿè¿ç§»
3. APIç½‘å…³éƒ¨ç½²
4. æœåŠ¡é—´é€šä¿¡æµ‹è¯•

### é˜¶æ®µ4ï¼šç›‘æ§å’Œä¼˜åŒ–ï¼ˆ1å‘¨ï¼‰
1. ç›‘æ§ç³»ç»Ÿéƒ¨ç½²
2. æ€§èƒ½è°ƒä¼˜
3. å®‰å…¨åŠ å›º
4. æ–‡æ¡£å®Œå–„

## ğŸ“Š é¢„æœŸæ”¶ç›Š

### æ€§èƒ½æå‡
- **å¹¶å‘å¤„ç†èƒ½åŠ›**: 10xæå‡
- **å“åº”æ—¶é—´**: å¹³å‡å“åº”æ—¶é—´ <200ms
- **å¯æ‰©å±•æ€§**: æ”¯æŒæ°´å¹³æ‰©å±•
- **å¯ç”¨æ€§**: 99.9%ç³»ç»Ÿå¯ç”¨æ€§

### å¼€å‘æ•ˆç‡
- **å¾®æœåŠ¡ç‹¬ç«‹æ€§**: å‡å°‘å¼€å‘å†²çª
- **å¿«é€Ÿéƒ¨ç½²**: æ”¯æŒç‹¬ç«‹éƒ¨ç½²
- **é—®é¢˜éš”ç¦»**: æ•…éšœå½±å“æœ€å°åŒ–
- **å›¢é˜Ÿåä½œ**: å¹¶è¡Œå¼€å‘æ”¯æŒ

### è¿ç»´æ•ˆç‡
- **è‡ªåŠ¨åŒ–ç¨‹åº¦**: 90%è‡ªåŠ¨åŒ–
- **ç›‘æ§å®Œå–„**: å…¨é“¾è·¯ç›‘æ§
- **æ•…éšœæ¢å¤**: è‡ªåŠ¨æ•…éšœè½¬ç§»
- **è¿ç»´æˆæœ¬**: é™ä½è¿ç»´å¤æ‚åº¦

## ğŸ”§ éƒ¨ç½²é…ç½®

### Docker Compose é…ç½®

```yaml
version: '3.8'
services:
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    command: redis-server --appendonly yes

  postgres:
    image: pgvector/pgvector:pg16
    environment:
      POSTGRES_DB: knowledge_base
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./sql/init.sql:/docker-entrypoint-initdb.d/init.sql

  document-service:
    build: ./services/document-service
    ports:
      - "8003:8003"
    environment:
      - DATABASE_URL=postgresql://postgres:5432/knowledge_base
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - postgres
      - redis

  search-service:
    build: ./services/search-service
    ports:
      - "8004:8004"
    environment:
      - DATABASE_URL=postgresql://postgres:5432/knowledge_base
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - postgres
      - redis

  agent-service:
    build: ./services/agent-service
    ports:
      - "8005:8005"
    environment:
      - DATABASE_URL=postgresql://postgres:5432/knowledge_base
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - postgres
      - redis

  notify-service:
    build: ./services/notify-service
    ports:
      -8006:8006
    environment:
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - redis

  user-service:
    build: ./services/user-service
    ports:
      - "8007:8007"
    environment:
      - DATABASE_URL=postgresql://postgres:5432/knowledge_base
      - JWT_SECRET=your-secret-key
    depends_on:
      - postgres

  api-gateway:
    build: ./services/api-gateway
    ports:
      - "8000:8000"
    depends_on:
      - document-service
      - search-service
      - agent-service
      - notify-service
      - user-service

volumes:
  postgres_data:
  redis_data:
```

## âš ï¸ é£é™©è¯„ä¼°ä¸ç¼“è§£

### æŠ€æœ¯é£é™©
1. **æ¶æ„å¤æ‚æ€§**: å¾®æœåŠ¡æ¶æ„å¢åŠ ç³»ç»Ÿå¤æ‚åº¦
   - ç¼“è§£æªæ–½ï¼šå®Œå–„æ–‡æ¡£ã€åŸ¹è®­å›¢é˜Ÿ
2. **åˆ†å¸ƒå¼äº‹åŠ¡**: æœåŠ¡é—´æ•°æ®ä¸€è‡´æ€§æŒ‘æˆ˜
   - ç¼“è§£æªæ–½ï¼šäº‹ä»¶æº¯æºã€è¡¥å¿äº‹åŠ¡
3. **ç½‘ç»œå»¶è¿Ÿ**: æœåŠ¡é—´é€šä¿¡å»¶è¿Ÿ
   - ç¼“è§£æªæ–½ï¼šå¼‚æ­¥å¤„ç†ã€ç¼“å­˜ä¼˜åŒ–

### è¿ç»´é£é™©
1. **éƒ¨ç½²å¤æ‚æ€§**: å®¹å™¨åŒ–éƒ¨ç½²éœ€è¦ä¸“ä¸šçŸ¥è¯†
   - ç¼“è§£æªæ–½ï¼šè‡ªåŠ¨åŒ–è„šæœ¬ã€è¯¦ç»†æ–‡æ¡£
2. **ç›‘æ§éš¾åº¦**: åˆ†å¸ƒå¼ç³»ç»Ÿç›‘æ§æŒ‘æˆ˜
   - ç¼“è§£æªæ–½ï¼šç»Ÿä¸€ç›‘æ§å¹³å°ã€å‘Šè­¦æœºåˆ¶
3. **æ•…éšœæ’æŸ¥**: é—®é¢˜å®šä½æ›´å¤æ‚
   - ç¼“è§£æªæ–½ï¼šé“¾è·¯è¿½è¸ªã€æ—¥å¿—èšåˆ

### æ•°æ®é£é™©
1. **æ•°æ®è¿ç§»**: æ•°æ®ä¸¢å¤±é£é™©
   - ç¼“è§£æªæ–½ï¼šå¤šæ¬¡å¤‡ä»½ã€å›æ»šæœºåˆ¶
2. **ä¸€è‡´æ€§é£é™©**: åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§
   - ç¼“è§£æªæ–½ï¼šäº‹ä»¶æº¯æºã€æœ€ç»ˆä¸€è‡´æ€§

## ğŸ“š ä¸‹ä¸€æ­¥è¡ŒåŠ¨

åŸºäºè¿™ä¸ªè®¾è®¡ï¼Œæˆ‘å»ºè®®æ‚¨ï¼š

1. **ç«‹å³å¼€å§‹**: ä»æ¶ˆæ¯ä»£ç†å’Œæ•°æ®åº“æ­å»ºå¼€å§‹
2. **ä¼˜å…ˆçº§**: å…ˆå®æ–½æ–‡æ¡£å’Œæœç´¢æœåŠ¡
3. **æ¸è¿›å¼**: é‡‡ç”¨é€æ­¥è¿ç§»ç­–ç•¥
4. **ç›‘æ§å…ˆè¡Œ**: ç¡®ä¿æ¯ä¸ªæ­¥éª¤éƒ½æœ‰å®Œå–„ç›‘æ§

æ‚¨å¸Œæœ›æˆ‘å¼€å§‹å®æ–½å“ªä¸ªå…·ä½“çš„æ¨¡å—å—ï¼Ÿæˆ‘å»ºè®®ä»Redisæ¶ˆæ¯ä»£ç†æ­å»ºå¼€å§‹ï¼Œè¿™æ˜¯æ•´ä¸ªæ¶æ„çš„åŸºç¡€ã€‚