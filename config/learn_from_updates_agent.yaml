# 自动学习Agent配置
name: learn_from_updates_agent
description: 自动学习机制 - 根据新增文件和提醒记录更新知识库
version: 1.0.0
author: System Administrator
created: 2025-11-06
updated: 2025-11-06

# ==================== 基础配置 ====================
config:
  # 数据库配置
  database:
    path: "knowledge_base.db"
    connection_timeout: 30
    max_connections: 5

  # 执行配置
  execution:
    default_interval_minutes: 60
    max_retry_attempts: 3
    retry_delay_seconds: 60
    batch_size: 20
    timeout_seconds: 600

  # 学习配置
  learning:
    scan_days_back: 7  # 扫描过去7天的文件
    min_file_size_kb: 1
    max_file_size_mb: 50
    confidence_threshold: 0.7
    auto_rebuild_embeddings: true
    supported_formats: ['.pdf', '.xlsx', '.xls', '.docx', '.doc', '.txt', '.csv']

# ==================== Agent Triggers ====================
triggers:
  # 定时学习触发器
  scheduled_learning:
    - name: weekly_learning_scan
      description: "每周一上午8点自动学习新文件"
      cron: "0 8 * * 1"  # 每周一上午8点
      timezone: "Asia/Shanghai"
      enabled: true
      priority: 1

    - name: daily_learning_check
      description: "每天晚上9点检查新增文件"
      cron: "0 21 * * *"  # 每天晚上9点
      timezone: "Asia/Shanghai"
      enabled: true
      priority: 2

  # 文件系统监控触发器
  file_system_monitor:
    - name: inquiry_updates_monitor
      description: "监控询价文件夹的更新"
      directories:
        - "/Users/gavin/Nutstore Files/.symlinks/坚果云/005-询盘询价和/"
      events:
        - "file_modified"
        - "file_added"
        - "directory_created"
      file_patterns:
        - "*.pdf"
        - "*.xlsx"
        - "*.xls"
        - "*.docx"
        - "*.doc"
        - "*.txt"
        - "*.csv"
      enabled: true
      priority: 3

    - name: customer_updates_monitor
      description: "监控客户文件夹的更新"
      directories:
        - "/Users/gavin/Nutstore Files/.symlinks/坚果云/002-客户中/"
      events:
        - "file_modified"
        - "file_added"
        - "directory_created"
      file_patterns:
        - "*.pdf"
        - "*.xlsx"
        - "*.xls"
        - "*.docx"
        - "*.doc"
        - "*.txt"
        - "*.csv"
      enabled: true
      priority: 4

  # 数据变化触发器
  database_monitor:
    - name: new_reminders_learning
      description: "当有新的提醒记录时触发学习"
      trigger_condition: "new_reminder_records > 0"
      check_interval_minutes: 30
      enabled: true
      priority: 5

# ==================== Agent Actions ====================
actions:
  primary:
    - name: scan_and_learn_updates
      description: "扫描并学习新文件更新"
      command: "python3 learn_from_updates.py --mode weekly"
      working_directory: "/Users/gavin/Knowledge base"
      timeout: 1200  # 20 minutes
      retry_count: 3
      retry_delay: 300  # 5 minutes

    - name: quick_learning_check
      description: "快速学习检查"
      command: "python3 learn_from_updates.py --mode daily"
      working_directory: "/Users/gavin/Knowledge base"
      timeout: 600  # 10 minutes
      retry_count: 2
      retry_delay: 180  # 3 minutes

  secondary:
    - name: update_embeddings_after_learning
      description: "学习后更新嵌入索引"
      command: "python3 build_embeddings.py --build --force"
      working_directory: "/Users/gavin/Knowledge base"
      timeout: 900  # 15 minutes
      condition: "learned_files_count > 0"

    - name: generate_learning_report
      description: "生成学习报告"
      command: "python3 generate_learning_report.py"
      working_directory: "/Users/gavin/Knowledge base"
      timeout: 300  # 5 minutes
      schedule: "0 22 * * *"  # 每天22点生成报告

    - name: cleanup_old_learning_logs
      description: "清理旧的学习日志"
      command: "python3 cleanup_learning_logs.py"
      working_directory: "/Users/gavin/Knowledge base"
      timeout: 120  # 2 minutes
      schedule: "0 2 * * 0"  # 每周日凌晨2点

# ==================== 学习规则配置 ====================
learning_rules:
  # 文件优先级规则
  file_priority:
    high_priority:
      - "*报价*"
      - "*询价*"
      - "*quote*"
      - "*inquiry*"
      - "*价格*"
      - "*price*"

    medium_priority:
      - "*规格*"
      - "*specification*"
      - "*标准*"
      - "*standard*"
      - "*技术*"
      - "*technical*"

    low_priority:
      - "*说明*"
      - "*介绍*"
      - "*introduction*"
      - "*manual*"

  # 内容质量评估
  content_quality:
    min_text_length: 100  # 最小文本长度
    required_elements:
      - "产品信息"
      - "规格参数"
      - "技术要求"

    quality_indicators:
      - "具体数值"
      - "标准编号"
      - "材料规格"
      - "尺寸参数"

  # 重复内容检测
  duplicate_detection:
    similarity_threshold: 0.9  # 相似度阈值
    check_fields: ["name", "description", "key_attributes"]
    action: "merge_update"  # 合并更新

  # 知识更新策略
  update_strategy:
    new_entries:
      action: "create_new"
      confidence_boost: 0.1

    existing_entries:
      high_similarity: "merge_attributes"
      medium_similarity: "update_attributes"
      low_similarity: "create_related"

# ==================== 学习数据源配置 ====================
data_sources:
  # 文件系统数据源
  file_system:
    scan_directories:
      - path: "/Users/gavin/Nutstore Files/.symlinks/坚果云/005-询盘询价和/"
        priority: "high"
        entity_types: ["inquiry", "quote"]

      - path: "/Users/gavin/Nutstore Files/.symlinks/坚果云/002-客户中/"
        priority: "medium"
        entity_types: ["customer", "inquiry"]

    ignore_patterns:
      - "*~"  # 临时文件
      - "*.tmp"
      - "*.temp"
      - ".*"  # 隐藏文件

  # 数据库数据源
  database:
    reminder_records:
      table: "reminder_records"
      fields_to_learn: ["content", "customer_info", "product_info", "notes"]
      entity_mapping:
        inquiry: "inquiry"
        quote: "quote"
        customer: "customer"

    strategy_suggestions:
      table: "strategy_suggestions"
      learn_from_implemented: true
      confidence_threshold: 0.8

# ==================== 学习输出配置 ====================
output:
  # 知识库更新
  knowledge_base:
    auto_save: true
    batch_size: 10
    validation_enabled: true

  # 学习日志
  learning_log:
    enabled: true
    file_path: "./data/processed/learning_log.json"
    log_level: "INFO"
    format: "json"
    max_file_size: "10MB"

  # 学习统计
  learning_stats:
    enabled: true
    update_interval_minutes: 60
    metrics:
      - "files_processed"
      - "entries_created"
      - "entries_updated"
      - "embeddings_regenerated"
      - "processing_time"

  # 学习报告
  learning_report:
    enabled: true
    output_format: "markdown"
    schedule: "weekly"
    sections:
      - "learning_summary"
      - "new_knowledge_entries"
      - "updated_entries"
      - "quality_metrics"
      - "recommendations"

# ==================== 错误处理和重试策略 ====================
error_handling:
  max_retries: 3
  retry_delay:
    initial: 60  # seconds
    max: 300     # 5 minutes
    backoff_factor: 2

  error_notifications:
    enabled: true
    recipients:
      - "admin@company.com"
    subject_prefix: "[Learning Agent Alert]"

  critical_errors:
    - "database_connection_failed"
    - "file_access_denied"
    - "parsing_engine_failed"
    - "embedding_generation_failed"

  retry_on_errors:
    - "timeout"
    - "file_busy"
    - "temporary_unavailable"
    - "network_error"

  skip_on_errors:
    - "corrupted_file"
    - "unsupported_format"
    - "access_denied"

# ==================== 工具权限配置 ====================
tools_allowed:
  FileSystem:
    permissions: ["Read", "Write"]
    allowed_paths:
      - "/Users/gavin/Nutstore Files/.symlinks/坚果云/"
      - "/Users/gavin/Knowledge base/data"
      - "/Users/gavin/Knowledge base/data/processed"

  PythonExecution:
    allowed_scripts:
      - "learn_from_updates.py"
      - "build_embeddings.py"
      - "generate_learning_report.py"
      - "cleanup_learning_logs.py"
    sandbox_enabled: true
    max_execution_time: 1200  # 20 minutes

  SQLiteAccess:
    allowed_databases:
      - "knowledge_base.db"
      - "./data/db.sqlite"
    allowed_operations: ["Read", "Write", "Update"]
    max_query_time: 300  # 5 minutes

  TextProcessing:
    enabled: true
    libraries:
      - "pdfplumber"
      - "openpyxl"
      - "python-docx"
      - "pandas"
      - "re"
      - "jieba"
      - "numpy"
      - "statistics"

# ==================== 资源限制 ====================
resources:
  max_memory: "2GB"
  max_cpu_time: 1200  # 20 minutes per execution
  max_concurrent_actions: 2
  max_file_size: "100MB"
  max_files_per_batch: 50

# ==================== 学习效果评估 ====================
learning_effectiveness:
  metrics:
    - "knowledge_growth_rate"
    - "search_accuracy_improvement"
    - "user_query_success_rate"
    - "automated_learning_coverage"

  evaluation_schedule:
    weekly_review: true
    monthly_report: true
    quarterly_optimization: true

  feedback_mechanisms:
    - user_rating_system
    - automatic_quality_assessment
    - search_result_analytics